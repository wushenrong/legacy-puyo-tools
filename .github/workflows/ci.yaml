# SPDX-FileCopyrightText: 2025 Samuel Wu
#
# SPDX-License-Identifier: MIT-0

name: Lint, format, and test

on:
  pull_request:
  push:
    branches:
      - main

jobs:
  lint:
    name: Lint and format
    runs-on: ubuntu-latest
    steps:
      # Setup environment
      - uses: actions/checkout@v4
      - uses: astral-sh/setup-uv@v6
      - uses: actions/setup-python@v5
        with:
          python-version-file: "pyproject.toml"

      # Disable rules about documentation and TODOs in CI.
      # Instead yell at the developer and let them decide when to add
      # documentation or remove TODOs.
      - name: Ruff lint
        run: uv run ruff check --fix --ignore=D101,D102,FIX002
      - name: Lint using pylint
        run: uv run pylint src tests --disable=C0115,C0116,W0511

      - name: Lint using pyright
        run: uv run pyright

      - name: Ruff format
        run: uv run ruff format

  test:
    name: Run tests
    strategy:
      matrix:
        os:
          - ubuntu-latest
          - macos-latest
          - windows-latest
    runs-on: ${{ matrix.os }}
    steps:
      - uses: actions/checkout@v4
      - uses: astral-sh/setup-uv@v3
      - uses: actions/setup-python@v5
        with:
          python-version-file: "pyproject.toml"

      - run: uv run pytest
